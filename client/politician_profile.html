<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>โปรไฟล์นักการเมือง</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>@import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap'); body { font-family: 'Sarabun', sans-serif; }</style>
</head>
<body class="bg-gray-50 text-gray-900">

    <div id="navbar-container"></div>

    <main class="max-w-5xl mx-auto px-4 py-10">
        <a href="politicians.html" class="inline-flex items-center text-sm text-gray-500 hover:text-blue-600 mb-6 transition">← กลับหน้ารายชื่อ</a>

        <div id="loading" class="text-center">กำลังโหลดข้อมูล...</div>
        
        <div id="content" class="hidden">
            <div class="bg-white rounded-2xl shadow-sm p-8 mb-8 border border-gray-100 flex flex-col md:flex-row items-center gap-8">
                <div class="w-24 h-24 rounded-full bg-gray-200 flex items-center justify-center text-3xl font-bold text-gray-400">
                    <span id="p-avatar">?</span>
                </div>
                <div class="text-center md:text-left">
                    <h1 id="p-name" class="text-3xl font-bold text-gray-900 mb-1"></h1>
                    <p id="p-party" class="text-lg text-blue-600 font-medium"></p>
                </div>
            </div>

            <h2 class="text-xl font-bold text-gray-900 mb-6 border-l-4 border-blue-500 pl-3">รายการคำสัญญา</h2>
            <div id="promises-list" class="space-y-4"></div>
        </div>
    </main>

    <script src="navbar.js"></script>
    <script>
        const API_URL = 'http://localhost:5000/api';
        const id = new URLSearchParams(window.location.search).get('id');

        async function fetchProfile() {
            if(!id) return;
            try {
                const res = await fetch(`${API_URL}/politicians/${id}`);
                const json = await res.json();
                if(json.status === 'success') renderProfile(json.data);
            } catch(e) { console.error(e); }
        }

        function renderProfile(data) {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('content').classList.remove('hidden');

            // Profile
            const p = data.profile;
            document.getElementById('p-name').innerText = p.name;
            document.getElementById('p-party').innerText = p.party;
            document.getElementById('p-avatar').innerText = p.name.charAt(0);

            // Promises
            const list = document.getElementById('promises-list');
            if(data.promises.length === 0) {
                list.innerHTML = '<p class="text-gray-500">ยังไม่มีคำสัญญา</p>';
            }
            data.promises.forEach(item => {
                let color = 'bg-gray-100 text-gray-800';
                if(item.status === 'กำลังดำเนินการ') color = 'bg-yellow-100 text-yellow-800';
                if(item.status === 'สำเร็จแล้ว') color = 'bg-green-100 text-green-800';
                if(item.status === 'เงียบหาย') color = 'bg-red-100 text-red-800';

                const html = `
                    <div class="bg-white p-5 rounded-lg border border-gray-200 shadow-sm flex justify-between items-center hover:border-blue-300 transition">
                        <div>
                            <h3 class="font-bold text-lg text-gray-900">
                                <a href="promise_detail.html?id=${item.promise_id}" class="hover:text-blue-600 transition">${item.description}</a>
                            </h3>
                            <p class="text-sm text-gray-500 mt-1">${item.announcement_date}</p>
                        </div>
                        <span class="${color} text-sm font-semibold px-3 py-1 rounded-full whitespace-nowrap ml-4">${item.status}</span>
                    </div>`;
                list.innerHTML += html;
            });
        }

        fetchProfile();
    </script>
</body>
</html>